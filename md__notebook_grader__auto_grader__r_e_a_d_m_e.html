<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GenJSONnotebookGrader: TODO</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GenJSONnotebookGrader<span id="projectnumber">&#160;1</span>
   </div>
   <div id="projectbrief">Autograder for notebooks in JSON format</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">TODO </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>Add_header can be moved to respective classes. Inheritance issue here</li>
<li>Is_dbc is still left in some places, even though it is not used</li>
</ul>
<h1><a class="anchor" id="autotoc_md78"></a>
Prologue</h1>
<ul>
<li>This is the branch of Generic Autograder that can handle jupyter and databricks notebooks.</li>
<li>It will have a small set of example notebooks and code to generate material</li>
<li>Make sure you have generated the needed notebooks and that they are in the correct format, as described in <a href="https://github.com/datascience-intro/test_course">test_course repo</a>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md79"></a>
Introduction</h1>
<p >This AutoGrader supports:-</p><ol type="1">
<li>Jupyter Notebook (*.ipynb*) with Python and SageMath kernels.</li>
<li>databricks Notebook (*.dbc*) with Python, Scala and Spark kernels. This one supports Python and Scala languages in a single notebook.</li>
</ol>
<h1><a class="anchor" id="autotoc_md80"></a>
Platform-specific NotebookGrader</h1>
<p >In the NotebookGrader package you can find the AutoGrader superclass with subclasses for IDS(jupyter) and Databricks AutoGraders.</p>
<h1><a class="anchor" id="autotoc_md81"></a>
Notebook AutoGrader</h1>
<h2><a class="anchor" id="autotoc_md82"></a>
Pre-configured files and relevant pre-setup</h2>
<p >For the grading of student submission notebooks, one has to pre-configure 3 files as follows:-</p>
<ol type="1">
<li><code>configGrading.json</code> This <code>configGrading.json</code> is the different file from the one used for the notebook extraction. One can find this file in <code>Autograder</code> directory. This file is mainly used to specify information needed for the system to grade student submission notebooks. <pre class="fragment"> {
     "course" : 54514,
     "API_URL" : "https://uppsala.instructure.com",
     "API_KEY" : "1111111~XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
     "API_KEY_OWNER": "Suparerk Angkawattanwit",
     "Assignments" : [
     {
         "name": "ASSIGNMENT_1",
         "studium_id" : 0,
         "master_filename" : "Master/Assignment_1_problem_TEST.dbc",
         "start_date" : "2022-05-01",
         "end_date" : "2022-05-31"
     },
     {
         "name": "ASSIGNMENT_2",
         "studium_id" : 0,
         "master_filename" : "Master/Assignment_2_problem_TEST.dbc",
         "start_date" : "2022-06-01",
         "end_date" : "2022-06-30"
     }
     ],
     "dbc_cluster_id": "9999-999999-xxxxxxxxxxxx",
     "dbc_cluster_name": "cluster-name"
     "dbc_workspace_dir" : /Users/email.com
 }
</pre> The description of each key in <code>configGrading.json</code> is in the table below:</li>
</ol>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Key   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">course   </td><td class="markdownTableBodyNone">Course ID on Studium. One can find it in the link in your browser's address bar.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">API_URL   </td><td class="markdownTableBodyNone">Link to Studium (or a link to Canvas Instructure used by your university)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">API_KEY   </td><td class="markdownTableBodyNone">An API key to access Studium. You can create one in the setting menu on Studium    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">API_KEY_OWNER   </td><td class="markdownTableBodyNone">(optional) A name of the owner of the API key    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Assignments   </td><td class="markdownTableBodyNone">A list of assignment names and grading periods    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">name   </td><td class="markdownTableBodyNone">Assignment name. This must be exactly the same one on Studium. If the system cannot find the name specified here on Studium, nothing is graded.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">studium_id   </td><td class="markdownTableBodyNone">This always has to be set as 0, according to the documentation.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">master_filename   </td><td class="markdownTableBodyNone">A path to an extracted notebook with problem and TEST cells    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">start_date   </td><td class="markdownTableBodyNone">A start date to grade the assignment. It starts at 00.01.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">end_date   </td><td class="markdownTableBodyNone">An end date to grade the assignment, It ends at 23.59.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dbc_cluster_id   </td><td class="markdownTableBodyNone">An ID of a cluster on databricks used to execute student submission notebooks. This can be found under "Automatically added tags" on your cluster page in databricks.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">dbc_cluster_name   </td><td class="markdownTableBodyNone">(optional) A name of the cluster on databricks.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">dbc_workspace_dir   </td><td class="markdownTableBodyNone">The databricks workspace of your choice.   </td></tr>
</table>
<blockquote class="doxtable">
<p >&zwj;<b>NOTE !</b> In case there are assignments with overlapped grading periods, the grading system will not start the next one until the current assignment's grading period ends. This means, practically, overlapped grading periods are not supported. However, if it is really necessary to have overlapped grading periods, one can work around by duplicating this set of codes (after extraction where extracted notebooks are present) and running the grading for two assignments separately. </p>
</blockquote>
<ol type="1">
<li><p class="startli"><code>.databrickscfg</code> This <code>.databrickscfg</code>file is used by <code>databricks CLI</code> in the AutoGrader system to specify a databricks workspace where student submission notebooks are executed and graded. First of all, one needs to install databricks CLI, using the following command:- </p><pre class="fragment">pip install databricks-cli
</pre> <blockquote class="doxtable">
<p >&zwj;Use an appropriate version of pip, e.g. pip3</p>
<p >Next, to configure the&lt;tt&gt;.databrickscfg file, one can find it in the user home directory. Set a link to a databricks workspace where student submission notebooks are executed, along with its access token. One can create an access token in User Settings on databricks workspace. In the example below, one can find there is a default section where default databricks workspace used to execute is specified. The middle one is the alternative workspace just in case the default one is not working. The last one is again the default. It is specified here again just to show the name of the databricks workspace. </p>
</blockquote>
<p>[DEFAULT] host = <a href="https://uppsalauni-xxxxxx-xx-projects.cloud.databricks.com/">https://uppsalauni-xxxxxx-xx-projects.cloud.databricks.com/</a> token = dapi11111111111111111111111111111111111 jobs-api-version = 2.1</p>
<p class="startli">[dbua-us-west] host = <a href="https://dbc-123ca456-xxxx.cloud.databricks.com/?o=4444444444#">https://dbc-123ca456-xxxx.cloud.databricks.com/?o=4444444444#</a> token = dapi222222222222222222222222222222222222 jobs-api-version = 2.1</p>
<p class="startli">[dbua-eu-west-1] host = <a href="https://uppsalauni-xxxxxx-xx-projects.cloud.databricks.com/">https://uppsalauni-xxxxxx-xx-projects.cloud.databricks.com/</a> token = dapi11111111111111111111111111111111111 jobs-api-version = 2.1</p>
</li>
<li><code>.netrc</code> This <code>.netrc</code>is used when the system downloads graded student notebooks. The system uses <code>curl</code> command in a bash script to download the graded notebook from databricks where the access token is needed. Therefore, one also needs to specify the access token here in this file. <pre class="fragment"> machine uppsalauni-xxxxxx-xx-projects.cloud.databricks.com
 login token
 password dapi11111111111111111111111111111111111

 machine dbc-123ca456-xxxx.cloud.databricks.com/?o=4444444444#
 login token
 password dapi222222222222222222222222222222222222
</pre></li>
<li><p class="startli">The symbolic link named <code>Master</code> Inside top directory of GenJSONnotebookGrader, there is a symbolic link named <code>Master</code>. This <code>Master</code> is linked to the directory where the extracted notebooks in the course are stored (e.g. <code>../test_course/GenerateMaterial/lectures</code>). You can recreate the symbolic link to your liking:</p>
<p class="startli">To remove the link, navigate to the top directory of this repo and: </p><pre class="fragment">rm Master
</pre><p> To create the link and then link it to the correct directory:</p>
</li>
</ol>
<pre class="fragment">ln -s ../&lt;...YourCourseDirectory...&gt;/GenerateMaterial/&lt;...YourExtractedNotebookDirectory...&gt;/ ./Master
</pre><p> For example, </p><pre class="fragment">rm Master
ln -s ../Course_Repo/GenerateMaterial/lectures/ ./Master
</pre> <blockquote class="doxtable">
<p >&zwj;For the symbolic link, there is no restriction to name it just only <code>Master</code>. A different name for the link can be used. However, one has to change the path in <code>master_filename</code> for each assignment in <code>configGrader.json</code> accordingly. </p>
</blockquote>
<blockquote class="doxtable">
<p >&zwj;In addition, one may decide to not use a symbolic link, but create an actual directory here instead, where TEST notebooks are copied and stored. </p>
</blockquote>
<blockquote class="doxtable">
<p >&zwj;The single dot (<code>.</code>) in the path means the current directory, while the double dots (<code>..</code>) means going up one level to its parent directory. </p>
</blockquote>
<ol type="1">
<li>Build <code>sds-sagemath-autograde</code> image for the grading of Jupyter notebooks Go into your course directory and run the following command: <pre class="fragment"> docker build -t sds-sagemath-autograde:latest -f Dockerfile-sds-autograde .
</pre> Then, check if the image is built successfully by using the following command:- <pre class="fragment">docker images
</pre> You will see <code>sds-sagemath-autograde</code> in the list of repository.</li>
</ol>
<h2><a class="anchor" id="autotoc_md83"></a>
Run AutoGrader</h2>
<p >In the <code>GenJSONnotebookGrader</code> directory, run the following command: </p><pre class="fragment">python3 Grader.py
</pre><ul>
<li>The autograder downloads the student submission notebooks from Studium and then grade them in the system. The points, comments (captured from TEST cells) and graded notebooks for student submissions (with commands in all TEST cells removed and left only with their cell results, preventing students from acessing the correct answers) will be uploaded to Studium as a feedback in a .dbc or .ipynb response notebook.</li>
<li>The AutoGrader creates a bunch of local files that can be used for hunting down errors.</li>
<li>The folder <code>SolutionWTest</code> has the student solutions with the corresponding TEST cells inserted.</li>
<li>The folder <code>StudentSubmission</code> has the student solutions that are downloaded from Studium.</li>
<li>The folder <code>Response</code> contains the student solutions with TEST cells already executed, but the TEST cell contents are removed and left only with the outputs. These notebooks are uploaded to Studium as responses for students.</li>
</ul>
<blockquote class="doxtable">
<p >&zwj;NOTE ! The grading process starts at <code>start_date</code>. After completing grading student submissions for one round, it sleeps for 30 minutes and starts another round of grading again and again (in case students resubmit assignments or have just submitted them for the first time) until the <code>end_date</code>. If the assignment period has not started yet, the NotebookGrader will check once every 24 hours. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md84"></a>
Final Notes !</h2>
<ol type="1">
<li>For databricks, if the notebook default language is Scala, all the code cells without a magic line (scala or python) will be treated as Scala. This also applies to Python.</li>
<li>The <code>configGrader.json</code> contains grading windows, and if you do not supply the master files before the grading window, the AutoGrader may crash. Then, one has to restart the <code>Grader.py</code> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
